# downloader
## General architecure
This is  a simple downloader, that is supposed to download files from different locations using different protocols. The protocol is identified from the url (which is passed as a string). Since the files can be of different sizes, the connection speed can be different etc. it seems logical to use anyncronous actors for processing the set of requests. There are a lot of different protocols which can be encountered, so the architecture must allow for easy extensibility, so the downloading logic and queueing logic are separated. The master actor creates a poll of workers that are protocol oblivious, but can actually make a choice and spawn an appropriate child. Such children can only download files using streams over a single protocol (in our case only FTP and HTTP are implemented) and report the result. In case of exception, the child actor simply reports a failure. In case of any protocol other than http or ftp (even, say, https) the script will report such file as impossible to download (as it is an unknown protocol). 

The results are accumulated in a single listener actor that collects the answers and makes sure that only successfully downloaded files are kept on the disk. There is a time tracking actor (optional) that reports of some file takes too long to download (this is not a timeout status, timeout status will actually be reported as failure).

There a separate little helper that transforms urls to file names in a uniform manner. At the moment the files are downloaded into a directory specified in a config (if not, the files are kept in the working directory) and routed to subdirectories according to their protocols (i.e.: `/download_directory/http`, `/download_directory/ftp` etc). The name is formed from the url by chopping off protocol extension and by replacing non-word symbols in URL by undersore (`www_the-village_ru_village_business.dwl` etc), the file extension is kept if known or replaced by "dwl" if none is given.  This is logic is kept in class test.Utilities.FileCreator.

## Extending
New protocols can be added by adding new classes to package test.Actors and by editing `test.Utilities.protocols` and method "receive" of `test.Utilities.Worker` class. It is assumed that new protocol-specific actors accept messages of type DownloadRequest and return messages of type ResultMessage to its parent, which later processes them. The rest of the system remains unaffected.

## Testing
Testing is kept to the minimum: protocol-specific actors should correctly report (and save) results of processing requests (both correct URL and non-existent URL). Listener agent, must keep track of sent and answered requests, it also needs to be able to clean up after workers that failed (no partially downloaded files etc). 

## Usage
This is an sbt project, it should assemble by simply running `sbt assembly`, actual Downloader is in class `Downloader`, which can be run from project's root as ` java -cp target/scala-2.10/downloader-assembly-1.0.jar  Downloader urls.txt `, where `urls.txt` is the file with the list of URLs to download (there is a sample list of files in the repository). The configuration of the downloader is in `src/main/resources/application.conf `, it is self-explanatory except perhaps master.parentDir -- this is a directory where the files are saved. It must be chosen so that the script is capable of writing in it (by default some directory inside of project's root is specified). The script is tested on Mac OSX and Linux (Debian and CentOS distributives).
